{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% if form_type == 'create' %}{% trans "Create Project" %}{% else %}{% trans "Edit Project" %}{% endif %}{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-8 col-xl-7">
    <div class="card">
      <div class="card-header d-flex justify-content-between align-items-center">
        <h2 class="mb-0" style="font-size:1.125rem; font-weight:700;">{% if form_type == 'create' %}{% trans "Create New Project" %}{% else %}{% trans "Edit Project" %}{% endif %}</h2>
        <a href="{% url 'projects:dashboard' %}" class="btn btn-ghost btn-sm">{% trans "Back" %}</a>
      </div>
      <div class="card-body">
        <form method="post" enctype="multipart/form-data" class="project-form-compact">
          {% csrf_token %}

          <div class="row g-3">
            <!-- Title -->
            <div class="col-12">
              <label for="id_title" class="form-label small mb-1">{% trans "Project Title" %}</label>
              {{ form.title }}
              {% if form.title.errors %}<div class="text-danger small">{{ form.title.errors }}</div>{% endif %}
            </div>

            <!-- Description -->
            <div class="col-12">
              <label for="id_description" class="form-label small mb-1">{% trans "Description" %}</label>
              {{ form.description }}
              {% if form.description.errors %}<div class="text-danger small">{{ form.description.errors }}</div>{% endif %}
            </div>

            <!-- Project Type & Publish -->
            <div class="col-md-6">
              <label for="id_project_type" class="form-label small mb-1">{% trans "Project Type" %}</label>
              {{ form.project_type }}
              {% if form.project_type.errors %}<div class="text-danger small">{{ form.project_type.errors }}</div>{% endif %}
            </div>
            <div class="col-md-6 d-flex align-items-end">
              <div class="form-check form-switch">
                {{ form.is_published }}
                <label class="form-check-label small" for="id_is_published">{% trans "Publish" %}</label>
              </div>
              {% if form.is_published.errors %}<div class="text-danger small ms-2">{{ form.is_published.errors }}</div>{% endif %}
            </div>

            <!-- Cover Image -->
            <div class="col-12">
              <label for="id_cover_image" class="form-label small mb-1">{% trans "Cover Image" %}</label>
              {{ form.cover_image }}
              {% if form.cover_image.errors %}<div class="text-danger small">{{ form.cover_image.errors }}</div>{% endif %}
              {% if form.cover_image.help_text %}<div class="form-text small">{{ form.cover_image.help_text }}</div>{% endif %}
            </div>

            <!-- Video File -->
            <div class="col-12">
              <label for="id_video_file" class="form-label small mb-1">{% trans "Video File" %}</label>
              {{ form.video_file }}
              {% if form.video_file.errors %}<div class="text-danger small">{{ form.video_file.errors }}</div>{% endif %}
              {% if form.video_file.help_text %}<div class="form-text small">{{ form.video_file.help_text }}</div>{% endif %}
            </div>
          </div>

          <!-- Advanced options collapsed -->
          <div class="mt-3">
            <button class="btn btn-link p-0 small" type="button" data-bs-toggle="collapse" data-bs-target="#advancedOptions" aria-expanded="false" aria-controls="advancedOptions">
              <i class="fas fa-sliders-h me-1"></i>{% trans "More options" %}
            </button>
            <div class="collapse mt-2" id="advancedOptions">
              <div class="border rounded p-3">
                <!-- Categories -->
                <div class="mb-3">
                  <label class="form-label small mb-1">{% trans "Categories" %}</label>
                  <div class="border p-2 rounded bg-light">
                    {% for checkbox in form.categories %}
                    <div class="form-check small mb-1">
                      {{ checkbox.tag }}
                      <label class="form-check-label" for="{{ checkbox.id_for_label }}">{{ checkbox.choice_label }}</label>
                    </div>
                    {% endfor %}
                  </div>
                  {% if form.categories.errors %}<div class="text-danger small">{{ form.categories.errors }}</div>{% endif %}
                </div>

                <!-- Video URL -->
                <div class="mb-3">
                  <label for="id_video_url" class="form-label small mb-1">{% trans "Video URL" %}</label>
                  {{ form.video_url }}
                  {% if form.video_url.errors %}<div class="text-danger small">{{ form.video_url.errors }}</div>{% endif %}
                  {% if form.video_url.help_text %}<div class="form-text small">{{ form.video_url.help_text }}</div>{% endif %}
                </div>

                <!-- Audio File -->
                <div class="mb-0">
                  <label for="id_audio_file" class="form-label small mb-1">{% trans "Audio File" %}</label>
                  {{ form.audio_file }}
                  {% if form.audio_file.errors %}<div class="text-danger small">{{ form.audio_file.errors }}</div>{% endif %}
                  {% if form.audio_file.help_text %}<div class="form-text small">{{ form.audio_file.help_text }}</div>{% endif %}
                </div>
              </div>
            </div>
          </div>

          <div class="d-flex justify-content-end gap-2 mt-3">
            <a href="{% url 'projects:dashboard' %}" class="btn btn-ghost btn-sm">{% trans "Cancel" %}</a>
            <button type="submit" class="btn btn-soft-primary btn-sm">
              {% if form_type == 'create' %}{% trans "Create Project" %}{% else %}{% trans "Update Project" %}{% endif %}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<style>
/* Compact form overrides scoped to this page */
.project-form-compact input[type="text"],
.project-form-compact input[type="url"],
.project-form-compact input[type="file"],
.project-form-compact select,
.project-form-compact textarea {
  font-size: .9rem;
  padding: .4rem .6rem;
}
.project-form-compact textarea { min-height: 120px; }
.project-form-compact .form-check-input { transform: scale(0.9); }
.project-form-compact .form-label { font-size: .85rem; }
.project-form-compact .form-text { font-size: .8rem; }

/* Local button variants */
.btn-soft-primary {
  color: #234;
  background: rgba(67, 97, 238, 0.12);
  border: 1px solid rgba(67, 97, 238, 0.35);
}
.btn-soft-primary:hover { background: rgba(67, 97, 238, 0.2); }
.btn-ghost {
  color: #495057;
  background: transparent;
  border: 1px dashed rgba(108, 117, 125, 0.5);
}
.btn-ghost:hover { background: rgba(108, 117, 125, 0.08); }
</style>
{% endblock %}